    <script>
        // ‚úÖ CONTEXTO DEL PRODUCTO PARA JAVASCRIPT
        window.productoContexto = {
            id: @Model.ProductoId,
            nombre: '@Html.Raw(Model.NombreProducto.Replace("'", "\\'"))',
            stock: @Model.CantidadEnInventario,
            stockMinimo: @Model.StockMinimo,
            precio: '@((Model.Precio ?? Model.PrecioCalculado ?? 0).ToString("N0"))',
            // Incluir la URL de la primera imagen si existe, para el modal de WhatsApp
            imagenPrincipal: '@(Model.Imagenes != null && Model.Imagenes.Any() ? Model.Imagenes.First().UrlImagen : "")'
        };

        // ‚úÖ INICIALIZAR CUANDO EL DOM EST√â LISTO
        $(document).ready(function() {
            // Inicializar tooltips
            inicializarTooltips();

            // Habilitar bot√≥n de enviar WhatsApp si el n√∫mero es v√°lido
            $('#numeroWhatsApp').on('input', function() {
                if ($(this).val().length === 8 && /^[0-9]+$/.test($(this).val())) {
                    $('#btnEnviarWhatsApp').prop('disabled', false);
                } else {
                    $('#btnEnviarWhatsApp').prop('disabled', true);
                }
            });

            // L√≥gica para llenar el preview del producto en el modal
            $('#modalWhatsAppNumero').on('show.bs.modal', function (event) {
                const producto = window.productoContexto;
                $('#productoPreview').html(`
                    <div class="d-flex align-items-center">
                        ${producto.imagenPrincipal ? `<img src="${producto.imagenPrincipal}" alt="${producto.nombre}" class="img-thumbnail me-3" style="width: 80px; height: 80px; object-fit: cover;">` : ''}
                        <div>
                            <strong>${producto.nombre}</strong><br>
                            <small>ID: ${producto.id}</small><br>
                            <small class="text-success">‚Ç°${producto.precio}</small>
                        </div>
                    </div>
                `);
                // Resetear el n√∫mero y el estado del bot√≥n al abrir el modal
                $('#numeroWhatsApp').val('');
                $('#btnEnviarWhatsApp').prop('disabled', true);
            });

            // L√≥gica para enviar por WhatsApp
            $('#btnEnviarWhatsApp').on('click', function() {
                const numero = $('#numeroWhatsApp').val();
                const incluirImagen = $('#incluirImagen').is(':checked');
                const producto = window.productoContexto;

                if (!numero || numero.length !== 8 || !/^[0-9]+$/.test(numero)) {
                    alert('Por favor, ingrese un n√∫mero de WhatsApp v√°lido de 8 d√≠gitos.');
                    return;
                }

                let mensaje = `¬°Hola! Te comparto este producto:\n\n`;
                mensaje += `*${producto.nombre}*\n`;
                mensaje += `Precio: ‚Ç°${producto.precio}\n`;
                mensaje += `Stock: ${producto.stock} unidades\n`;
                mensaje += `M√°s detalles: ${window.location.origin}${window.location.pathname}\n`; // URL de la p√°gina actual

                if (incluirImagen && producto.imagenPrincipal) {
                    // Nota: WhatsApp no soporta enviar im√°genes directamente por URL en mensajes de texto.
                    // Se enviar√° el enlace a la imagen. Para una integraci√≥n m√°s avanzada, se necesitar√≠a una API de WhatsApp.
                    mensaje += `\nImagen: ${producto.imagenPrincipal}`;
                }

                const urlWhatsApp = `https://wa.me/+506${numero}?text=${encodeURIComponent(mensaje)}`;

                // Mostrar estado de carga
                $(this).find('.normal-state').hide();
                $(this).find('.loading-state').show();
                $(this).prop('disabled', true);

                // Simular env√≠o (en una app real, se har√≠a una llamada a la API)
                setTimeout(() => {
                    window.open(urlWhatsApp, '_blank');
                    $('#modalWhatsAppNumero').modal('hide');
                    // Ocultar estado de carga y resetear el bot√≥n
                    $(this).find('.loading-state').hide();
                    $(this).find('.normal-state').show();
                }, 1500); // Simula un peque√±o retraso
            });

            console.log('üéØ Vista de detalle lista con contexto:', window.productoContexto);
        });

        // Funci√≥n para ser llamada desde el bot√≥n en el HTML
        function compartirProducto() {
            $('#modalWhatsAppNumero').modal('show');
        }

    </script>
