@namespace TucoMAUI.Pages
<h3>Iniciar Sesión</h3>

<div>
    <label>Correo:</label>
    <input @bind="email" />
</div>
<div>
    <label>Contraseña:</label>
    <input type="password" @bind="password" />
</div>
<div>
    <button @onclick="HandleLogin">Ingresar</button>
</div>
@if (!string.IsNullOrEmpty(errorMessage))
{
    <p style="color: red;">@errorMessage</p>
}

@code {
    private string email = string.Empty;
    private string password = string.Empty;
    private string errorMessage = string.Empty;

    private async Task HandleLogin()
    {
        try
        {
            // Llamar al servicio para autenticar al usuario
            var loginResponse = await usuarioService.AutenticarUsuarioAsync(email, password);

            if (loginResponse != null && !string.IsNullOrEmpty(loginResponse.Token))
            {
                // Guardar el token si es necesario
                Console.WriteLine($"Token recibido: {loginResponse.Token}");

                // Mostrar alerta de bienvenida
                await JSRuntime. InvokeVoidAsync("Swal.fire", new
                {
                    title = "¡Bienvenido!",
                    text = "Inicio de sesión exitoso.",
                    icon = "success",
                    timer = 2000,
                    showConfirmButton = false
                });

                // Esperar a que la alerta se cierre automáticamente
                await Task.Delay(2000);

                // Redirigir a la página principal
                navigationManager.NavigateTo("/", forceLoad: true);
            }
            else
            {
                errorMessage = "Credenciales inválidas.";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Error al iniciar sesión: {ex.Message}";
        }
    }
}